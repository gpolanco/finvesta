---
description:
globs:
alwaysApply: true
---

# ðŸ§  Cursor Rules para Finvesta - App de Finanzas Personales

## ðŸ“‹ CONTEXTO DEL PROYECTO

### ðŸŽ¯ QuÃ© estamos construyendo

- **Finvesta**: App web de finanzas personales con Next.js 15 + Supabase
- **Usuario especÃ­fico**: 45 aÃ±os, 3.730â‚¬/mes ingreso, 1.500â‚¬/mes ahorro objetivo
- **Problema**: 22.000â‚¬ sin rentabilidad + 10.000â‚¬ cripto (19.2% del patrimonio)
- **Meta 5 aÃ±os**: <15% cripto, <20kâ‚¬ liquidez, 100kâ‚¬ patrimonio neto

### ðŸ—ï¸ Stack TecnolÃ³gico FIJO

- **Frontend**: Next.js 15 (App Router), React, TypeScript
- **UI**: TailwindCSS 4 + Shadcn/UI
- **Backend**: Supabase (DB + Auth + RLS)
- **GrÃ¡ficos**: Recharts
- **Forms**: React Hook Form + Zod
- **Deploy**: Vercel

## ðŸ”„ FLUJO DE TRABAJO AI TASKS

### ðŸ“‚ DÃ³nde encontrar contexto SIEMPRE

1. **`tasks/project-context.md`** - Contexto financiero del usuario (LEER PRIMERO)
2. **`tasks/README.md`** - DocumentaciÃ³n completa del sistema
3. **`tasks/current-task.md`** - Tarea actual en progreso
4. **`src/`** - CÃ³digo implementado hasta ahora

### ðŸŽ¯ Orden ESTRICTO de implementaciÃ³n

```
tasks/001-setup/ â†’ tasks/002-accounts/ â†’ tasks/003-dashboard/ â†’ tasks/004-alerts/ â†’ tasks/005-reports/
```

### ðŸ“‹ Antes de CUALQUIER cÃ³digo

1. **LEE** `tasks/project-context.md` para entender la situaciÃ³n financiera especÃ­fica
2. **REVISA** la tarea actual en `tasks/current-task.md`
3. **VERIFICA** dependencias completadas en tareas anteriores
4. **CONFIRMA** el subtask especÃ­fico a implementar
5. **LEE** `tasks/templates/getting-started.md` para entender el flujo de trabajo

## ðŸŽ¨ PRINCIPIOS DE DESARROLLO

### ðŸ’° Financiero-First

- **SIEMPRE** usar nÃºmeros reales del usuario (22kâ‚¬ liquidez, 10kâ‚¬ cripto, 3.730â‚¬/mes ingreso, 1.500â‚¬/mes ahorro)
- **KPIs crÃ­ticos**: patrimonio neto, % cripto, liquidez sin rentabilidad
- **Alertas automÃ¡ticas**: cripto >15%, liquidez >20kâ‚¬, ahorro <1.500â‚¬
- **CÃ¡lculos precisos**: usar Decimal.js para matemÃ¡ticas financieras

### ðŸš€ Performance y UX

- **Registro transacciones**: <10 segundos obligatorio
- **Dashboard**: cargar KPIs en <3 segundos
- **Mobile-first**: responsive design desde dÃ­a 1
- **Optimistic updates**: UX fluida sin esperas

### ðŸ”’ Seguridad

- **RLS policies**: usuario solo ve sus datos
- **TypeScript strict**: sin any, validaciones completas
- **Validaciones dobles**: frontend + backend
- **Env variables**: secretos nunca en cÃ³digo

## ðŸ“ ESTÃNDARES DE CÃ“DIGO

### ðŸ—‚ï¸ Estructura de archivos

```
src/
â”œâ”€â”€ app/                   # Next.js 15 App Router
â”‚   â”œâ”€â”€ (auth)/            # Rutas de autenticaciÃ³n
â”‚   â”œâ”€â”€ dashboard/         # Dashboard principal
â”‚   â””â”€â”€ layout.tsx         # Layout global
â”œâ”€â”€ features/              # LÃ³gica por dominio
â”‚   â”œâ”€â”€ accounts/          # GestiÃ³n de cuentas
â”‚   â”œâ”€â”€ transactions/      # Transacciones
â”‚   â”œâ”€â”€ dashboard/         # KPIs y analytics
â”‚   â”œâ”€â”€ alerts/            # Sistema de alertas
â”‚   â””â”€â”€ shared/            # Componentes reutilizables
â”‚       â”œâ”€â”€ components/    # Componentes reutilizables
â”‚       â”‚   â”œâ”€â”€ ui/            # Shadcn/UI components
â”‚       â”‚   â”œâ”€â”€ forms/         # Formularios especÃ­ficos
â”‚       â”‚   â””â”€â”€ charts/        # Componentes de grÃ¡ficas
â”‚       â”œâ”€â”€ hooks/           # Hooks
â”‚       â”œâ”€â”€ lib/             # Utilities y helpers
â”‚       â”œâ”€â”€ validations/     # Esquemas Zod
â”‚       â”œâ”€â”€ types/             # Tipos TypeScript globales
â”‚       â””â”€â”€ utils/           # Helpers generales
```

### ðŸ·ï¸ Naming Conventions

- **Componentes**: PascalCase (`TransactionForm`)
- **Hooks**: camelCase con `use` (`useTransactions`)
- **Utils**: camelCase (`calculateNetWorth`)
- **Types**: PascalCase (`UserAccount`, `Transaction`)
- **Constants**: UPPER_SNAKE_CASE (`MAX_CRYPTO_PERCENTAGE`)

### ðŸ“Š Datos financieros

```typescript
// SIEMPRE usar estos tipos para cÃ¡lculos
import Decimal from "decimal.js";

interface FinancialKPIs {
  netWorth: Decimal; // Patrimonio neto total
  cryptoPercentage: Decimal; // % cripto del patrimonio
  monthlyGoal: Decimal; // 1500â‚¬ objetivo mensual
  liquidityNoReturn: Decimal; // Liquidez sin rentabilidad
}

// Constantes crÃ­ticas del usuario
const USER_FINANCIAL_GOALS = {
  MONTHLY_SAVINGS_TARGET: new Decimal(1500),
  MAX_CRYPTO_PERCENTAGE: new Decimal(15),
  MAX_LIQUID_NO_RETURN: new Decimal(20000),
  TARGET_NET_WORTH_5Y: new Decimal(100000),
};
```

## ðŸŽ¯ IMPLEMENTACIÃ“N POR SUBTASKS

### âš¡ Reglas de subtask

- **MÃ¡ximo 1-2 horas** por subtask
- **1 funcionalidad completa** por vez
- **Testing incluido** en cada subtask
- **Commit al final** de cada subtask

### ðŸ“‹ Template de commit especÃ­fico Finvesta

```
feat(scope): descripciÃ³n breve

- Implementa funcionalidad X segÃºn task-00X-Y
- Incluye validaciones y tipos TypeScript
- AÃ±ade tests unitarios para casos crÃ­ticos
- Cumple criterios de Ã©xito definidos
- Don't forget to commit!

Refs: tasks/00X-scope/subtask-Y.md
```

## ðŸ§ª TESTING OBLIGATORIO

### ðŸ” QuÃ© testear SIEMPRE

```typescript
// 1. CÃ¡lculos financieros crÃ­ticos
describe("Financial calculations", () => {
  it("calculates net worth correctly with real user data", () => {
    const accounts = [
      { balance: new Decimal(22000), type: "bank" },
      { balance: new Decimal(10000), type: "crypto" },
    ];
    expect(calculateNetWorth(accounts)).toBe(new Decimal(32000));
  });
});

// 2. Validaciones de negocio
it("alerts when crypto > 15% of net worth", () => {
  const netWorth = new Decimal(32000);
  const cryptoValue = new Decimal(10000); // 31.25%
  expect(shouldAlertCryptoHigh(cryptoValue, netWorth)).toBe(true);
});

// 3. Componentes crÃ­ticos
it("transaction form saves in <10 seconds", async () => {
  const startTime = Date.now();
  await submitTransaction(mockData);
  expect(Date.now() - startTime).toBeLessThan(10000);
});
```

## ðŸš¨ ALERTAS Y VALIDACIONES

### ðŸ’¡ Sistema de alertas automÃ¡ticas

```typescript
interface Alert {
  type: "critical" | "warning" | "info";
  title: string;
  message: string;
  action?: string; // AcciÃ³n especÃ­fica sugerida
  value?: Decimal; // Valor que disparÃ³ la alerta
}

// Ejemplos con datos reales del usuario
const ALERT_RULES = {
  cryptoTooHigh: (cryptoPercent: Decimal) => ({
    type: "warning",
    title: "Cripto representa el ${cryptoPercent}% de tu patrimonio",
    message: "Considera rebalancear. Objetivo: <15%",
    action: "Vender â‚¬${amount} y reinvertir en fondos indexados",
  }),
  liquidityTooHigh: (amount: Decimal) => ({
    type: "critical",
    title: "â‚¬${amount} sin rentabilidad",
    message: "Dinero parado perdiendo inflaciÃ³n",
    action: "Mover â‚¬${amount-20000} a cuenta remunerada o fondos",
  }),
};
```

## ðŸ”„ WORKFLOW CON CURSOR

### ðŸ“ Al empezar nueva sesiÃ³n

1. **Cursor**: "Lee tasks/project-context.md y dime el estado actual"
2. **Cursor**: "Â¿QuÃ© subtask de tasks/current-task.md debo implementar?"
3. **Cursor**: "Muestra la estructura de archivos relevante para esta subtask"

### ðŸŽ¯ Al implementar subtask

1. **Cursor**: "Implementa la subtask X siguiendo exactamente los pasos definidos"
2. **Cursor**: "Incluye TypeScript types, validaciones y tests"
3. **Cursor**: "Usa los nÃºmeros reales del usuario (22kâ‚¬ liquidez, 10kâ‚¬ cripto, 3.730â‚¬/mes ingreso)"
4. **Cursor**: "Verifica que cumples todos los criterios de Ã©xito"

### âœ… Al completar subtask

1. **Cursor**: "Crea commit con formato especificado"
2. **Cursor**: "Actualiza tasks/current-task.md con progreso"
3. **Cursor**: "Sugiere prÃ³xima subtask o validaciones pendientes"

## ðŸš€ COMANDOS ÃšTILES

### ðŸ”§ Setup y desarrollo

```bash
# Instalar dependencias especÃ­ficas
npm install @supabase/supabase-js @hookform/resolvers zod decimal.js
npm install recharts lucide-react date-fns

# Testing
npm test -- --watch
npm run type-check

# Build y deploy
npm run build
npm run start
```

### ðŸ“Š Debugging financiero

```typescript
// Helper para debug de cÃ¡lculos
const debugFinancials = (user: UserData) => {
  console.log("ðŸ“Š Financial Debug:", {
    netWorth: user.netWorth.toString(),
    cryptoPercent: user.cryptoPercentage.toString() + "%",
    liquidNoReturn: user.liquidityNoReturn.toString(),
    alerts: user.activeAlerts.map((a) => a.type),
  });
};
```

## ðŸŽ¯ REMEMBER ALWAYS

- **User-centric**: Todo gira en torno a optimizar las finanzas del usuario especÃ­fico
- **Numbers matter**: 22kâ‚¬ liquidez, 10kâ‚¬ cripto, 3.730â‚¬/mes ingreso son datos REALES, no ejemplos
- **Performance critical**: Registro transacciones <10s, dashboard <3s
- **Context is king**: Siempre leer project-context.md antes de cualquier implementaciÃ³n
- **Incremental**: Subtasks pequeÃ±as, completas y testeadas

---

ðŸŽ¯ **OBJETIVO FINAL**: App que automatice la estrategia financiera del usuario hacia 100kâ‚¬ patrimonio neto optimizado en 5 aÃ±os, con alertas inteligentes que guÃ­en decisiones especÃ­ficas.
