# ğŸ§  Cursor Rules para Finvesta - App de Finanzas Personales

## ğŸ“‹ CONTEXTO DEL PROYECTO

### ğŸ¯ QuÃ© estamos construyendo

- **Finvesta**: App web de finanzas personales con Next.js 15 + Supabase
- **Usuario especÃ­fico**: 45 aÃ±os, 3.730â‚¬/mes ingreso, 1.500â‚¬/mes ahorro objetivo
- **Problema**: 22.000â‚¬ sin rentabilidad + 10.000â‚¬ cripto (19.2% del patrimonio)
- **Meta 5 aÃ±os**: <15% cripto, <20kâ‚¬ liquidez, 100kâ‚¬ patrimonio neto

### ğŸ—ï¸ Stack TecnolÃ³gico FIJO

- **Frontend**: Next.js 15 (App Router), React, TypeScript
- **UI**: TailwindCSS 4 + Shadcn/UI
- **Backend**: Supabase (DB + Auth + RLS)
- **GrÃ¡ficos**: Recharts
- **Forms**: React Hook Form + Zod
- **Deploy**: Vercel

## ğŸ”„ FLUJO DE TRABAJO AI TASKS

### ğŸ“‚ DÃ³nde encontrar contexto SIEMPRE

1. **`tasks/project-context.md`** - Contexto financiero del usuario (LEER PRIMERO)
2. **`tasks/README.md`** - DocumentaciÃ³n completa del sistema
3. **`tasks/current-task.md`** - Tarea actual en progreso
4. **`src/`** - CÃ³digo implementado hasta ahora

### ğŸ¯ Orden ESTRICTO de implementaciÃ³n

```
tasks/001-setup/ â†’ tasks/002-accounts/ â†’ tasks/003-dashboard/ â†’ tasks/004-alerts/ â†’ tasks/005-reports/
```

### ğŸ“‹ Antes de CUALQUIER cÃ³digo

1. **LEE** `tasks/project-context.md` para entender la situaciÃ³n financiera especÃ­fica
2. **REVISA** la tarea actual en `tasks/current-task.md`
3. **VERIFICA** dependencias completadas en tareas anteriores
4. **CONFIRMA** el subtask especÃ­fico a implementar
5. **LEE** `tasks/templates/getting-started.md` para entender el flujo de trabajo

## ğŸ¨ PRINCIPIOS DE DESARROLLO

### ğŸ’° Financiero-First

- **SIEMPRE** usar nÃºmeros reales del usuario (22kâ‚¬ liquidez, 10kâ‚¬ cripto, 3.730â‚¬/mes ingreso, 1.500â‚¬/mes ahorro)
- **KPIs crÃ­ticos**: patrimonio neto, % cripto, liquidez sin rentabilidad
- **Alertas automÃ¡ticas**: cripto >15%, liquidez >20kâ‚¬, ahorro <1.500â‚¬
- **CÃ¡lculos precisos**: usar Decimal.js para matemÃ¡ticas financieras

### ğŸš€ Performance y UX

- **Registro transacciones**: <10 segundos obligatorio
- **Dashboard**: cargar KPIs en <3 segundos
- **Mobile-first**: responsive design desde dÃ­a 1
- **Optimistic updates**: UX fluida sin esperas

### ğŸ”’ Seguridad

- **RLS policies**: usuario solo ve sus datos
- **TypeScript strict**: sin any, validaciones completas
- **Validaciones dobles**: frontend + backend
- **Env variables**: secretos nunca en cÃ³digo

## ğŸ“ ESTÃNDARES DE CÃ“DIGO

### ğŸ—‚ï¸ Estructura de archivos

```
src/
â”œâ”€â”€ app/                   # Next.js 15 App Router
â”‚   â”œâ”€â”€ (auth)/            # Rutas de autenticaciÃ³n
â”‚   â”œâ”€â”€ dashboard/         # Dashboard principal
â”‚   â””â”€â”€ layout.tsx         # Layout global
â”œâ”€â”€ features/              # LÃ³gica por dominio
â”‚   â”œâ”€â”€ accounts/          # GestiÃ³n de cuentas
â”‚   â”œâ”€â”€ transactions/      # Transacciones
â”‚   â”œâ”€â”€ dashboard/         # KPIs y analytics
â”‚   â”œâ”€â”€ alerts/            # Sistema de alertas
â”‚   â””â”€â”€ shared/            # Componentes reutilizables
â”‚       â”œâ”€â”€ components/    # Componentes reutilizables
â”‚       â”‚   â”œâ”€â”€ ui/            # Shadcn/UI components
â”‚       â”‚   â”œâ”€â”€ forms/         # Formularios especÃ­ficos
â”‚       â”‚   â””â”€â”€ charts/        # Componentes de grÃ¡ficas
â”‚       â”œâ”€â”€ hooks/           # Hooks
â”‚       â”œâ”€â”€ lib/             # Utilities y helpers
â”‚       â”œâ”€â”€ validations/     # Esquemas Zod
â”‚       â”œâ”€â”€ types/             # Tipos TypeScript globales
â”‚       â””â”€â”€ utils/           # Helpers generales
```

### ğŸ·ï¸ Naming Conventions

- **Componentes**: PascalCase (`TransactionForm`)
- **Hooks**: camelCase con `use` (`useTransactions`)
- **Utils**: camelCase (`calculateNetWorth`)
- **Types**: PascalCase (`UserAccount`, `Transaction`)
- **Constants**: UPPER_SNAKE_CASE (`MAX_CRYPTO_PERCENTAGE`)

### ğŸ“„ Estructura de pÃ¡ginas

```typescript
// SIEMPRE usar PageWrapper para pÃ¡ginas nuevas
import { PageWrapper } from "@/features/shared/components/page-wrapper";

export default function ExamplePage() {
  return (
    <PageWrapper
      title="TÃ­tulo de la pÃ¡gina"
      description="DescripciÃ³n opcional"
      className="optional-classes"
    >
      {/* Contenido de la pÃ¡gina */}
    </PageWrapper>
  );
}
```

### ğŸ—‚ï¸ Estados vacÃ­os en listas

```typescript
// SIEMPRE usar EmptyContent para listas vacÃ­as
import { EmptyContent } from "@/features/shared/components/empty-content";
import { PiggyBank, Receipt, Plus, AlertTriangle } from "lucide-react";

// Estado vacÃ­o bÃ¡sico
<EmptyContent
  title="No tienes cuentas registradas"
  description="AÃ±ade tu primera cuenta para empezar a gestionar tus finanzas"
  icon={PiggyBank}
/>

// Estado vacÃ­o con botÃ³n de acciÃ³n
<EmptyContent
  title="No hay transacciones"
  description="Registra tu primera transacciÃ³n para hacer seguimiento de tus finanzas"
  icon={Receipt}
  buttonText="AÃ±adir transacciÃ³n"
  createPath="/transactions/create"
  buttonIcon={Plus}
  fullHeight={false}
/>

// Props disponibles:
interface EmptyContentProps {
  title: string;                    // TÃ­tulo principal (obligatorio)
  description: string;              // DescripciÃ³n explicativa (obligatorio)
  icon?: LucideIcon;               // Icono (opcional, default: PiggyBank)
  fullHeight?: boolean;            // Altura completa (default: true)
  buttonText?: string;             // Texto del botÃ³n (opcional)
  createPath?: string;             // Ruta para crear (opcional)
  buttonIcon?: LucideIcon;         // Icono del botÃ³n (default: Plus)
}

// Casos de uso especÃ­ficos Finvesta:
// 1. Cuentas vacÃ­as: icon={PiggyBank}, createPath="/accounts/create"
// 2. Transacciones vacÃ­as: icon={Receipt}, createPath="/transactions/create"
// 3. Alertas vacÃ­as: icon={AlertTriangle}, sin botÃ³n (no se crean manualmente)
// 4. Reportes vacÃ­os: icon={FileText}, sin botÃ³n (se generan automÃ¡ticamente)
```

### ğŸ“Š Datos financieros

```typescript
// SIEMPRE usar estos tipos para cÃ¡lculos
import Decimal from "decimal.js";

interface FinancialKPIs {
  netWorth: Decimal; // Patrimonio neto total
  cryptoPercentage: Decimal; // % cripto del patrimonio
  monthlyGoal: Decimal; // 1500â‚¬ objetivo mensual
  liquidityNoReturn: Decimal; // Liquidez sin rentabilidad
}

// Constantes crÃ­ticas del usuario
const USER_FINANCIAL_GOALS = {
  MONTHLY_SAVINGS_TARGET: new Decimal(1500),
  MAX_CRYPTO_PERCENTAGE: new Decimal(15),
  MAX_LIQUID_NO_RETURN: new Decimal(20000),
  TARGET_NET_WORTH_5Y: new Decimal(100000),
};
```

## ğŸ¯ IMPLEMENTACIÃ“N POR SUBTASKS

### âš¡ Reglas de subtask

- **MÃ¡ximo 1-2 horas** por subtask
- **1 funcionalidad completa** por vez
- **Testing incluido** en cada subtask
- **Commit al final** de cada subtask

### ğŸ“‹ Template de commit especÃ­fico Finvesta

```
feat(scope): descripciÃ³n breve

- Implementa funcionalidad X segÃºn task-00X-Y
- Incluye validaciones y tipos TypeScript
- AÃ±ade tests unitarios para casos crÃ­ticos
- Cumple criterios de Ã©xito definidos
- Don't forget to commit!

Refs: tasks/00X-scope/subtask-Y.md
```

## ğŸ§ª TESTING OBLIGATORIO

### ğŸ” QuÃ© testear SIEMPRE

```typescript
// 1. CÃ¡lculos financieros crÃ­ticos
describe("Financial calculations", () => {
  it("calculates net worth correctly with real user data", () => {
    const accounts = [
      { balance: new Decimal(22000), type: "bank" },
      { balance: new Decimal(10000), type: "crypto" },
    ];
    expect(calculateNetWorth(accounts)).toBe(new Decimal(32000));
  });
});

// 2. Validaciones de negocio
it("alerts when crypto > 15% of net worth", () => {
  const netWorth = new Decimal(32000);
  const cryptoValue = new Decimal(10000); // 31.25%
  expect(shouldAlertCryptoHigh(cryptoValue, netWorth)).toBe(true);
});

// 3. Componentes crÃ­ticos
it("transaction form saves in <10 seconds", async () => {
  const startTime = Date.now();
  await submitTransaction(mockData);
  expect(Date.now() - startTime).toBeLessThan(10000);
});
```

## ğŸš¨ ALERTAS Y VALIDACIONES

### ğŸ’¡ Sistema de alertas automÃ¡ticas

```typescript
interface Alert {
  type: "critical" | "warning" | "info";
  title: string;
  message: string;
  action?: string; // AcciÃ³n especÃ­fica sugerida
  value?: Decimal; // Valor que disparÃ³ la alerta
}

// Ejemplos con datos reales del usuario
const ALERT_RULES = {
  cryptoTooHigh: (cryptoPercent: Decimal) => ({
    type: "warning",
    title: "Cripto representa el ${cryptoPercent}% de tu patrimonio",
    message: "Considera rebalancear. Objetivo: <15%",
    action: "Vender â‚¬${amount} y reinvertir en fondos indexados",
  }),
  liquidityTooHigh: (amount: Decimal) => ({
    type: "critical",
    title: "â‚¬${amount} sin rentabilidad",
    message: "Dinero parado perdiendo inflaciÃ³n",
    action: "Mover â‚¬${amount-20000} a cuenta remunerada o fondos",
  }),
};
```

## ğŸ”„ WORKFLOW CON CURSOR

### ğŸ“ Al empezar nueva sesiÃ³n

1. **Cursor**: "Lee tasks/project-context.md y dime el estado actual"
2. **Cursor**: "Â¿QuÃ© subtask de tasks/current-task.md debo implementar?"
3. **Cursor**: "Muestra la estructura de archivos relevante para esta subtask"

### ğŸ¯ Al implementar subtask

1. **Cursor**: "Implementa la subtask X siguiendo exactamente los pasos definidos"
2. **Cursor**: "Incluye TypeScript types, validaciones y tests"
3. **Cursor**: "Usa los nÃºmeros reales del usuario (22kâ‚¬ liquidez, 10kâ‚¬ cripto, 3.730â‚¬/mes ingreso)"
4. **Cursor**: "Verifica que cumples todos los criterios de Ã©xito"

### âœ… Al completar subtask

1. **Cursor**: "Crea commit con formato especificado"
2. **Cursor**: "Actualiza tasks/current-task.md con progreso"
3. **Cursor**: "Sugiere prÃ³xima subtask o validaciones pendientes"

## ğŸš€ COMANDOS ÃšTILES

### ğŸ”§ Setup y desarrollo

```bash
# Instalar dependencias especÃ­ficas
npm install @supabase/supabase-js @hookform/resolvers zod decimal.js
npm install recharts lucide-react date-fns

# Testing
npm test -- --watch
npm run type-check

# Build y deploy
npm run build
npm run start
```

### ğŸ“Š Debugging financiero

```typescript
// Helper para debug de cÃ¡lculos
const debugFinancials = (user: UserData) => {
  console.log("ğŸ“Š Financial Debug:", {
    netWorth: user.netWorth.toString(),
    cryptoPercent: user.cryptoPercentage.toString() + "%",
    liquidNoReturn: user.liquidityNoReturn.toString(),
    alerts: user.activeAlerts.map((a) => a.type),
  });
};
```

## ğŸš¨ LECCIONES APRENDIDAS Y ERRORES A EVITAR

### âŒ Errores cometidos en subtask 002-1

1. **Enfoque client-side inicial**

   - âŒ CreÃ© componente con `"use client"`, `useState`, `useEffect`
   - âœ… **Correcto**: Server-side con actions + Suspense
   - ğŸ“ **LecciÃ³n**: Siempre priorizar server-side data loading

2. **No verificar estructura existente**

   - âŒ CreÃ© `src/app/accounts/` sin verificar `src/app/(dashboard)/accounts/`
   - âœ… **Correcto**: Usar `list_dir` antes de crear archivos
   - ğŸ“ **LecciÃ³n**: Explorar estructura antes de implementar

3. **Duplicar layout comÃºn**

   - âŒ IncluÃ­ `SidebarProvider` en pÃ¡gina cuando existÃ­a `DashboardLayout`
   - âœ… **Correcto**: Verificar layouts existentes
   - ğŸ“ **LecciÃ³n**: Aprovechar layouts comunes

4. **Asumir sin consultar**
   - âŒ No consultÃ© carpetas existentes
   - âœ… **Correcto**: Verificar antes de crear
   - ğŸ“ **LecciÃ³n**: `list_dir` es obligatorio

### ğŸ”„ Protocolo OBLIGATORIO antes de implementar

1. **ExploraciÃ³n de estructura**:

   ```bash
   # SIEMPRE ejecutar antes de crear archivos
   list_dir src/app/
   list_dir src/features/[feature]/
   ```

2. **Verificar layouts existentes**:

   - Buscar `layout.tsx` en rutas padre
   - No duplicar `SidebarProvider`, `AppSidebar`, etc.
   - Adaptar pÃ¡ginas a layouts comunes

3. **Arquitectura server-side**:

   - Actions en `src/features/[feature]/actions/`
   - Componentes server que reciben props
   - Skeletons separados en `components/`
   - `Suspense` en pÃ¡ginas para loading

4. **Orden de implementaciÃ³n**:
   - ğŸ“‚ Explorar estructura existente
   - ğŸ—ï¸ Crear actions server-side
   - ğŸ§© Crear componentes server
   - ğŸ’€ Crear skeletons separados
   - ğŸ“„ Crear/actualizar pÃ¡ginas con Suspense

### ğŸ¯ Checklist pre-implementaciÃ³n

- [ ] Â¿ExplorÃ© la estructura de `src/app/` con `list_dir`?
- [ ] Â¿VerifiquÃ© si existe un layout comÃºn?
- [ ] Â¿PlanifiquÃ© la arquitectura server-side?
- [ ] Â¿IdentifiquÃ© donde crear actions y components?
- [ ] Â¿EntendÃ­ el contexto financiero del usuario?

## ğŸ¯ REMEMBER ALWAYS

- **User-centric**: Todo gira en torno a optimizar las finanzas del usuario especÃ­fico
- **Numbers matter**: 22kâ‚¬ liquidez, 10kâ‚¬ cripto, 3.730â‚¬/mes ingreso son datos REALES, no ejemplos
- **Performance critical**: Registro transacciones <10s, dashboard <3s
- **Context is king**: Siempre leer project-context.md antes de cualquier implementaciÃ³n
- **Incremental**: Subtasks pequeÃ±as, completas y testeadas
- **Structure first**: Explorar antes de crear, verificar antes de implementar

---

ğŸ¯ **OBJETIVO FINAL**: App que automatice la estrategia financiera del usuario hacia 100kâ‚¬ patrimonio neto optimizado en 5 aÃ±os, con alertas inteligentes que guÃ­en decisiones especÃ­ficas.

---

ğŸ¯ **OBJETIVO FINAL**: App que automatice la estrategia financiera del usuario hacia 100kâ‚¬ patrimonio neto optimizado en 5 aÃ±os, con alertas inteligentes que guÃ­en decisiones especÃ­ficas.

## ğŸ—‚ï¸ Patrones de arquitectura: SeparaciÃ³n Actions & Services

Para toda feature que requiera lÃ³gica de negocio y acceso a datos, se debe separar:

- **services/**: Funciones puras de acceso a datos (CRUD, Supabase, etc). Sin lÃ³gica de Next.js ni UI. Reutilizables en tests, scripts, otras server actions.
- **actions/**: Solo Server Actions de Next.js (funciones asÃ­ncronas con "use server"). Usan los services para exponer lÃ³gica al frontend (formularios, botones, etc). Pueden hacer revalidatePath, manejo de errores para UI, etc. Una acciÃ³n por archivo.

**Ventajas:**

- Claridad y separaciÃ³n de responsabilidades
- Escalabilidad y mantenibilidad
- ReutilizaciÃ³n de lÃ³gica de datos
- Alineado con Next.js 15 y buenas prÃ¡cticas modernas

**Ejemplo de estructura:**

```
src/features/<feature>/
â”œâ”€â”€ actions/
â”‚   â”œâ”€â”€ create-<entity>-action.ts
â”‚   â”œâ”€â”€ update-<entity>-action.ts
â”‚   â””â”€â”€ delete-<entity>-action.ts
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ create-<entity>.ts
â”‚   â”œâ”€â”€ update-<entity>.ts
â”‚   â”œâ”€â”€ delete-<entity>.ts
â”‚   â””â”€â”€ get-<entity>.ts
```

**DiÃ¡logos y formularios:**

- Todos los formularios que se muestren en un modal/dialog deben ser envueltos por un componente comÃºn `FormDialog` (en `features/shared/components`).
- El formulario debe ser un componente separado y reutilizable, sin lÃ³gica de modal.
- Esto asegura consistencia visual, accesibilidad y facilita cambios globales de UX.

Esta separaciÃ³n permite construir lÃ³gica financiera compleja, alertas y automatizaciones reutilizando los servicios de datos, mientras que las Server Actions mantienen la integraciÃ³n Ã³ptima con la UI y la experiencia Next.js.
